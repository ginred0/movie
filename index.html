<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Movie!</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Lato:wght@300;400&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="./css/styles.css" />

  <!-- Firebase SDK (Compat) placed before app scripts) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-functions-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
</head>
<body>
  <!-- å·¦ä¸Šè§’ç”¨æˆ·å…¥å£ -->
  <div class="user-corner" id="userCorner">
    <!-- æœªç™»å½•æ—¶æ˜¾ç¤ºç«ç„° -->
    <div class="corner-flame" id="cornerFlame" onclick="showLoginModal()">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
        <path d="M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29.59 2.65.59 4.04 0 2.65-2.15 4.8-4.8 4.8z"/>
      </svg>
    </div>
    
    <!-- ç™»å½•åæ˜¾ç¤ºç”¨æˆ·å¤´åƒ -->
    <div class="corner-avatar" id="cornerAvatar" onclick="toggleUserMenu()" style="display:none;">
      <div class="corner-avatar-img" id="cornerAvatarImg"></div>
      <div class="corner-badge" id="cornerBadge" style="display:none;">0</div>
    </div>
  </div>

  <!-- ç”¨æˆ·ä¸‹æ‹‰èœå• -->
  <div class="user-dropdown" id="userDropdown">
    <div class="user-dropdown-header">
      <div class="dropdown-avatar" id="dropdownAvatar"></div>
      <div class="dropdown-info">
        <div class="dropdown-nickname" id="dropdownNickname"></div>
        <div class="dropdown-style" id="dropdownStyle"></div>
      </div>
    </div>
    <div class="user-dropdown-body">
      <div class="dropdown-info-item">
        <strong>æœ€å–œæ¬¢çš„å¯¼æ¼”ï¼š</strong><span id="dropdownDirector"></span>
      </div>
      <div class="dropdown-info-item">
        <strong>æœ€å–œæ¬¢çš„ç”µå½±ï¼š</strong><span id="dropdownFilm"></span>
      </div>
      <div class="dropdown-badges" id="dropdownBadges"></div>
    </div>
    <div class="user-dropdown-actions">
      <button class="dropdown-btn" onclick="showUserPage(window.currentUser.id)">ğŸ‘¤ æŸ¥çœ‹æˆ‘çš„ä¸»é¡µ</button>
      <button class="dropdown-btn" onclick="editOwnProfile()">âœï¸ ç¼–è¾‘èµ„æ–™</button>
      <button class="dropdown-btn" onclick="showMyMessages()">ğŸ“¬ æŸ¥çœ‹æˆ‘çš„ç•™è¨€</button>
      <button class="dropdown-btn" onclick="showAdminPrompt()">ğŸ‘‘ ç®¡ç†å‘˜æ¨¡å¼</button>
      <button class="dropdown-btn" onclick="logoutUser()">ğŸšª é€€å‡ºç™»å½•</button>
      <button class="dropdown-btn danger" onclick="deleteOwnAccount()">âš ï¸ æ³¨é”€è´¦æˆ·</button>
    </div>
  </div>

  <!-- ç”µå½±èƒ¶ç‰‡èƒŒæ™¯ -->
  <div class="film-strip-background" id="filmBackground"></div>

  <!-- æµåŠ¨è¯—æ„æ’ç‰ˆçš„å¯¼æ¼”åå­— -->
  <div class="directors-layer" id="directorsLayer"></div>

  <!-- å³ä¸‹è§’æµ‹éªŒæŒ‰é’®ï¼ˆä»…ç™»å½•åæ˜¾ç¤ºï¼‰ -->
  <div class="quiz-icon-button" id="quizIconButton" onclick="startQuiz()" title="å¼€å§‹æµ‹éªŒ" style="display:none;">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
      <path d="M18 3v2h-2V3H8v2H6V3H4v18h2v-2h2v2h8v-2h2v2h2V3h-2zM8 17H6v-2h2v2zm0-4H6v-2h2v2zm0-4H6V7h2v2zm10 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z"/>
    </svg>
  </div>

  <!-- å¯¼æ¼”å¼¹çª— -->
  <div class="modal" id="directorModal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal()">&times;</span>
      <div id="modalBody"></div>
    </div>
  </div>

  <!-- æµ‹éªŒè¦†ç›–å±‚ -->
  <div class="quiz-overlay" id="quizOverlay">
    <!-- æµ‹éªŒé¡µé¢ -->
    <div id="quizPage" class="quiz-container">
      <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
      <div class="question-number" id="questionNumber">é—®é¢˜ 1 / 5</div>
      <div class="question-text" id="questionText"></div>
      <div class="question-image hidden" id="questionImage"><img id="questionImg" alt="question" /></div>
      <div id="answerContainer">
        <input id="answerInput" class="answer-input" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ" />
        <div id="optionsContainer" class="options-container hidden"></div>
      </div>
      <button class="quiz-button" onclick="handleNext()">ä¸‹ä¸€é¢˜</button>
      <button class="quiz-button" onclick="closeQuiz()">å…³é—­</button>
    </div>
  </div>

  <!-- ç™»å½•/æ³¨å†Œæ¨¡æ€æ¡† -->
  <div class="login-modal-overlay" id="loginModalOverlay" onclick="closeLoginModal()"></div>
  <div class="login-modal" id="loginModal">
    <span class="modal-close" onclick="closeLoginModal()">&times;</span>
    
    <!-- ç™»å½•/æ³¨å†Œé€‰æ‹© -->
    <div id="loginChoice" class="login-choice">
      <h2>Welcome!</h2>
      <button class="choice-button" onclick="showRegisterForm()">ğŸ”¥ ç¬¬ä¸€æ¬¡æ¥ï¼Ÿ</button>
      <button class="choice-button" onclick="showLoginForm()">âœ¨ å·²ç»æ¥è¿‡ï¼Ÿ</button>
    </div>

    <!-- ç™»å½•è¡¨å• -->
    <div id="loginForm" class="auth-form hidden">
      <h2>ç™»å½•</h2>
      <form onsubmit="handleLogin(event)">
        <div class="form-group">
          <label for="loginNickname">æ˜µç§°</label>
          <input id="loginNickname" type="text" required placeholder="è¾“å…¥ä½ çš„æ˜µç§°" />
        </div>
        <div class="form-group">
          <label for="loginPassword">å¯†ç </label>
          <input id="loginPassword" type="password" required placeholder="è¾“å…¥ä½ çš„å¯†ç " />
        </div>
        <button type="submit" class="submit-button">ç™»å½•</button>
        <button type="button" class="back-button" onclick="showLoginChoice()">è¿”å›</button>
      </form>
    </div>

    <!-- æ³¨å†Œè¡¨å• -->
    <div id="registerForm" class="auth-form hidden">
      <h2>æ³¨å†Œ</h2>
      <form onsubmit="handleRegister(event)" id="regForm">
        <!-- å¤´åƒé€‰æ‹©å™¨ -->
        <div class="form-group">
          <label>é€‰æ‹©å¤´åƒ *</label>
          <small>ç‚¹å‡»é€‰æ‹©ï¼Œæœªé€‰æ‹©å°†è‡ªåŠ¨ç”Ÿæˆé¦–å­—æ¯å¤´åƒ</small>
          <div class="avatar-selector" id="avatarSelector">
            <div class="avatar-option" data-avatar="wave" title="æµªæ½®">ğŸŒŠ</div>
            <div class="avatar-option" data-avatar="tomato" title="ç•ªèŒ„">ğŸ…</div>
            <div class="avatar-option" data-avatar="lightning" title="é—ªç”µ">âš¡</div>
            <div class="avatar-option" data-avatar="star" title="æ˜Ÿæ˜Ÿ">â­</div>
            <div class="avatar-option" data-avatar="saturn" title="åœŸæ˜Ÿ">ğŸª</div>
            <div class="avatar-option" data-avatar="comet" title="å½—æ˜Ÿ">â˜„ï¸</div>
            <div class="avatar-option" data-avatar="alien" title="å¤–æ˜Ÿäºº">ğŸ‘½</div>
            <div class="avatar-option" data-avatar="devil" title="æ¶é­”">ğŸ‘¿</div>
            <div class="avatar-option" data-avatar="wing" title="ç¿…è†€">ğŸª½</div>
            <div class="avatar-option" data-avatar="potato" title="åœŸè±†">ğŸ¥”</div>
          </div>
          <input type="hidden" id="selectedAvatar" value="" />
        </div>

        <!-- æ˜µç§° -->
        <div class="form-group">
          <label for="regNickname">æ˜µç§° *</label>
          <input id="regNickname" type="text" required placeholder="è¾“å…¥ä½ çš„æ˜µç§°" />
        </div>

        <!-- å¯†ç  -->
        <div class="form-group">
          <label for="regPassword">å¯†ç  *</label>
          <input id="regPassword" type="password" required placeholder="è‡³å°‘4ä¸ªå­—ç¬¦" />
        </div>
        <div class="form-group">
          <label for="regPasswordConfirm">ç¡®è®¤å¯†ç  *</label>
          <input id="regPasswordConfirm" type="password" required placeholder="å†æ¬¡è¾“å…¥å¯†ç " />
        </div>

        <!-- æœ€å–œæ¬¢çš„å¥³å¯¼æ¼” -->
        <div class="form-group">
          <label for="favoriteDirector">æœ€å–œæ¬¢çš„å¥³å¯¼æ¼” *</label>
          <input id="favoriteDirector" type="text" required placeholder="å¦‚ï¼šé˜¿æ¶…æ–¯Â·ç“¦å°”è¾¾" />
        </div>

        <!-- æœ€å–œæ¬¢çš„å¥³æ€§ç”µå½± -->
        <div class="form-group">
          <label for="favoriteFilm">æœ€å–œæ¬¢çš„å¥³æ€§ç”µå½± *</label>
          <input id="favoriteFilm" type="text" required placeholder="å¦‚ï¼šç‡ƒçƒ§å¥³å­çš„è‚–åƒ" />
        </div>

        <!-- æœ€è¿‘çœ‹çš„ç”µå½±ï¼ˆå¯é€‰ï¼‰ -->
        <div class="form-group">
          <label for="recentFilm">æœ€è¿‘çœ‹çš„ä¸€éƒ¨ç”µå½±ï¼ˆå¯é€‰ï¼‰</label>
          <input id="recentFilm" type="text" placeholder="å¦‚ï¼šé˜¿æ¶…æ–¯è®ºç“¦å°”è¾¾" />
        </div>

        <!-- åˆ†äº«æƒ³æ³•ï¼ˆå¯é€‰ï¼‰ -->
        <div class="form-group">
          <label for="thoughts">åˆ†äº«ä½ æœ€è¿‘å¥½ç©çš„æƒ³æ³•ï¼ˆå¯é€‰ï¼‰</label>
          <textarea id="thoughts" rows="3" placeholder="å†™ä¸‹ä½ çš„æƒ³æ³•..."></textarea>
        </div>

        <button type="submit" class="submit-button">æ³¨å†Œ</button>
        <button type="button" class="back-button" onclick="showLoginChoice()">è¿”å›</button>
      </form>
    </div>
  </div>

  <!-- ç”¨æˆ·é¡µé¢æ¨¡æ€æ¡† -->
  <div class="user-modal-overlay" id="userModalOverlay" onclick="closeUserModal()"></div>
  <div class="user-modal" id="userModal">
    <span class="modal-close" onclick="closeUserModal()">&times;</span>
    <!-- å·¦å³åˆ‡æ¢æŒ‰é’® -->
    <div class="user-chevron prev" onclick="userChevronPrev()" aria-label="ä¸Šä¸€ä½">&lt;</div>
    <div class="user-chevron next" onclick="userChevronNext()" aria-label="ä¸‹ä¸€ä½">&gt;</div>
    <div id="userContent" class="user-content"></div>
  </div>

  <!-- ç”¨æˆ·åˆ—è¡¨ä¾§è¾¹æ  -->
  <div class="users-sidebar-overlay" id="usersSidebarOverlay" onclick="closeUsersSidebar()"></div>
  <div class="users-sidebar" id="usersSidebar">
    <div id="usersSidebarGrid" class="sidebar-users-grid"></div>
  </div>
  <!-- å³ä¾§æ ‡ç­¾æŒ‰é’®ï¼šç‚¹å‡»åˆ‡æ¢ä¾§è¾¹æ  -->
  <div class="users-sidebar-tab" id="usersSidebarTab" onclick="toggleUsersSidebarTab()" title="ç”¨æˆ·åˆ—è¡¨">&lt;</div>

  <!-- æˆ‘çš„ç•™è¨€é¡µé¢ -->
  <div class="my-messages-overlay" id="myMessagesOverlay" onclick="closeMyMessages()"></div>
  <div class="my-messages-page" id="myMessagesPage">
    <div class="messages-header">
      <h2>æˆ‘æ”¶åˆ°çš„ç•™è¨€</h2>
      <span class="modal-close" onclick="closeMyMessages()">&times;</span>
    </div>
    <div id="myMessagesList" class="messages-list"></div>
  </div>

  <!-- åŠ è½½æç¤º -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <div class="loading-text">åŠ è½½ä¸­...</div>
    </div>
  </div>

  <!-- å¾½ç« æç¤ºæ°”æ³¡ -->
  <div class="badge-toast hidden" id="badgeToast">
    <span class="badge-icon-toast" id="badgeToastIcon"></span>
    <span id="badgeToastText"></span>
  </div>

  <!-- ç®¡ç†å‘˜å¯†ç è¾“å…¥å¼¹çª— -->
  <div class="admin-prompt-overlay" id="adminPromptOverlay" onclick="closeAdminPrompt()"></div>
  <div class="admin-prompt" id="adminPrompt">
    <h3>è¾“å…¥ç®¡ç†å‘˜å¯†ç </h3>
    <input type="password" id="adminPasswordInput" placeholder="å¯†ç " />
    <div class="admin-prompt-buttons">
      <button onclick="confirmAdminPassword()">ç¡®å®š</button>
      <button onclick="closeAdminPrompt()">å–æ¶ˆ</button>
    </div>
  </div>

  <!-- App Scripts: æ³¨æ„é¡ºåºï¼Œéæ¨¡å—ï¼Œå…¨å±€æš´éœ² -->
  <script defer src="./js/config.js"></script>
  <script defer src="./js/data.js"></script>
  <script defer src="./js/firebase.js"></script>
  <script defer src="./js/firebase.js"></script>
  <script defer src="./js/ui.js"></script>
  <script defer src="./js/quiz.js"></script>
  <script defer src="./js/user.js"></script>
  <script defer src="./js/admin.js"></script>
  <script defer src="./js/gestures.js"></script>
  <script defer src="./js/messages.js"></script>
  <script>
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function(){
      if (window.initAvatarSelector) window.initAvatarSelector();
      if (window.initGestures) window.initGestures();
      if (window.initUserCorner) window.initUserCorner();
      if (window.initUsersSidebarTab) window.initUsersSidebarTab();
    });
  </script>
</body>
</html>
